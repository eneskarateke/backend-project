(()=>{var e={234:(e,t,s)=>{const r=s(860).Router(),o=s(432),n=s(344),{JWT_SECRET:a,HASH_ROUND:i}=s(632),c=s(706),d=s(642),u=s(763),w=s(631);r.post("/register",w,u,(async(e,t,s)=>{const{username:r}=e.body;try{const s=await c.addUser({username:r,password:e.hashedPassword});t.status(201).json(s)}catch(e){s(e)}})),r.post("/login",w,d,((e,t,s)=>{const{password:r}=e.body;if(e.user&&o.compareSync(r,e.user.password)){const s={id:e.user.user_id,username:e.user.username},r={expiresIn:"24h"},o=n.sign(s,a,r);t.json({message:`welcome ${e.user.username}`,token:o})}else s(error)})),e.exports=r},521:(e,t,s)=>{const r=s(115),o=s(390);e.exports={createComment:async function(e,t,s,n){try{if(!await o.getByTweetId(e))throw new Error("Tweet not found");const[a]=await r("comments").insert({tweet_id:e,tweeted_id:n,commented_id:t||null,comment_text:s});return a}catch(e){throw new Error("Failed to create comment")}},getCommentById:async function(e){try{return await r("comments").select().where("id_comment",e).first()}catch(e){throw new Error("Failed to retrieve comment")}},getTweetWithComments:async function(e){try{const t=await r("tweets").join("users","tweets.user_id","=","users.user_id").select("tweets.*","users.username as tweeted_by").where("tweet_id",e).first();if(!t)throw new Error("Tweet not found");const s=await r("comments").select().where("tweet_id",e).orderBy("created_at","desc");return t.comments=s,{tweet:t}}catch(e){throw new Error("Failed to retrieve tweet and comments")}},deleteComment:async function(e){try{return await r("comments").where("id_comment",e).del()}catch(e){throw new Error("Failed to delete comment")}}}},845:(e,t,s)=>{const r=s(860),o=s(521),n=s(944),a=r.Router();a.post("/:tweetId",n,(async(e,t,s)=>{const{tweetId:r}=e.params,{comment_text:n,commented_id:a}=e.body;try{const s=await o.createComment(r,a,n,e.tweeted_id),i=await o.getCommentById(s);t.status(201).json(i)}catch(e){s(e)}})),a.get("/:tweetId",(async(e,t,s)=>{const{tweetId:r}=e.params;try{const e=await o.getTweetWithComments(r);t.status(200).json(e)}catch(e){s(e)}})),a.delete("/:commentId",(async(e,t,s)=>{const{commentId:r}=e.params;try{if(!await o.deleteComment(r))throw new Error("Failed to delete comment.");t.status(200).json({message:"Comment deleted successfully."})}catch(e){s(e)}})),e.exports=a},830:(e,t,s)=>{const r=s(115);e.exports=async(e,t,s)=>{const{id_follower:o}=e.body,n=e.params.id;try{if((await r("followers").where({id_user:n,id_follower:o}).count("id_user as count").first()).count>0)return t.status(400).json({error:"User is already being followed."});s()}catch(e){s(e)}}},858:e=>{e.exports=async(e,t,s)=>{const{id_follower:r}=e.body,o=e.params.id;Number(o)===Number(r)?t.status(400).json({error:"User cannot follow themselves."}):s()}},666:(e,t,s)=>{const r=s(706);e.exports=async(e,t,s)=>{r.getById(e.params.id)?s():t.status(400).json({message:"User could not found!"})}},44:e=>{e.exports=async(e,t,s)=>{const{id_follower:r}=e.body,o=e.params.id;r&&o?s():t.status(401).json({message:"follower id ve user id gereklidir"})}},202:(e,t,s)=>{const r=s(115);e.exports=async(e,t,s)=>{const{id_follower:o}=e.body,n=e.params.id;try{if(!((await r("followers").where({id_user:n,id_follower:o}).count("id_user as count").first()).count>0))return t.status(400).json({error:"User is not already being followed."});s()}catch(e){s(e)}}},41:(e,t,s)=>{const r=s(115);async function o(e){return await r("users").where("user_id",e).first()}e.exports={createFollower:async function(e,t){const[s]=await r("followers").insert({id_user:e,id_follower:t});return s},deleteFollower:async function(e,t){return await r("followers").where({id_user:e,id_follower:t}).del()},getFollowers:async function(e){const t=await r("followers").where("id_user",e).join("users","users.user_id","=","followers.id_follower").select("users.user_id","users.username"),s=await o(e);return{user_id:Number(e),username:s.username,followers:t}},getUserById:o}},106:(e,t,s)=>{const r=s(860).Router(),o=s(41),n=s(44),a=s(666),i=s(830),c=s(858),d=s(202);r.post("/:id",n,c,i,(async(e,t,s)=>{const{id_follower:r}=e.body,n=e.params.id;try{if(!await o.createFollower(n,r))throw new Error("Failed to create follower.");{const[e,s]=await Promise.all([o.getUserById(n),o.getUserById(r)]);t.status(200).json({message:"Follower created successfully.",user:{user_id:e.user_id,username:e.username},follower:{user_id:s.user_id,username:s.username}})}}catch(e){s(e)}})),r.delete("/:id",n,d,(async(e,t,s)=>{const{id_follower:r}=e.body,n=e.params.id;try{if(!await o.deleteFollower(n,r))throw new Error("Failed to delete follower.");t.status(200).json({message:"Follower deleted successfully."})}catch(e){s(e)}})),r.get("/:userId",a,(async(e,t,s)=>{const r=e.params.userId;try{const e=await o.getFollowers(r);t.status(200).json({followers:e})}catch(e){s(e)}})),e.exports=r},663:(e,t,s)=>{const r=s(115);e.exports={likeTweet:async function(e,t,s){try{const o={tweet_id:e,liked_id:t,tweeted_id:s},[n]=await r("likes").insert(o);return await r("likes").join("tweets","tweets.tweet_id","likes.tweet_id").select("likes.*","tweets.*").where("likes.id_like",n).first()}catch(e){throw e}},unlikeTweet:async function(e,t){try{return await r("likes").where("tweet_id",e).andWhere("liked_id",t).del()}catch(e){throw e}}}},561:(e,t,s)=>{const r=s(860),{likeTweet:o,unlikeTweet:n}=s(663),a=s(356),i=s(944),c=r.Router();c.post("/:tweetId",i,a,(async(e,t,s)=>{try{const s=e.params.tweetId,r=e.body.liked_id,n=await o(s,r,e.tweeted_id);return t.json(n)}catch(e){s(e)}})),c.delete("/:tweetId",(async(e,t,s)=>{try{const s=e.params.tweetId,r=e.body.liked_id;if(await n(s,r))return t.json({message:"Like has been undone!"});t.json({message:"There is no such a like!"})}catch(e){s(e)}})),e.exports=c},356:(e,t,s)=>{const r=s(115);e.exports=async(e,t,s)=>{try{const o=e.params.tweetId,n=e.body.liked_id;if((await r("likes").select("*").where("tweet_id","=",o).andWhere("liked_id","=",n)).length>0)return t.status(409).json({message:"You have already liked this tweet"});s()}catch(e){s(e)}}},944:(e,t,s)=>{const r=s(390);e.exports=async(e,t,s)=>{try{const o=e.params.tweetId,n=await r.getByTweetId(o);if(null==n)return t.status(404).json({message:"Tweet couldn't found!"});e.tweeted_id=n.user_id,s()}catch(e){s(e)}}},390:(e,t,s)=>{const r=s(115);function o(e){return r("tweets").select("tweets.tweet_id","users.username","users.user_id","tweets.tweet").from("tweets").join("users","tweets.user_id","users.user_id").where("tweets.tweet_id",e).first()}e.exports={getAll:function(){return r("tweets")},getByUserId:function(e){return r("tweets").select("tweets.tweet_id","users.username","tweets.tweet").from("tweets").join("users","tweets.user_id","users.user_id").where("tweets.user_id",e)},addTweet:async function(e,t){const s={user_id:e,tweet:t},[n]=await r("tweets").insert(s);return await o(n)},getByTweetId:o,deleteTweet:async function(e){return await r("tweets").where("tweet_id",e).del().then((()=>r("tweets").select("tweet_id","tweet").where("tweet_id",e).first()))}}},543:(e,t,s)=>{const r=s(860).Router(),o=s(390);r.get("/",(async(e,t,s)=>{try{const e=await o.getAll();t.json(e)}catch(e){s(e)}})),r.get("/:userId",(async(e,t,s)=>{const r=e.params.userId;try{const e=await o.getByUserId(r);t.json(e)}catch(e){s(e)}})),r.post("/:userId",(async(e,t,s)=>{try{const s=e.params.userId,{tweet:r}=e.body,n=await o.addTweet(s,r);t.status(201).json(n)}catch(e){s(e)}})),r.delete("/:tweetId",(async(e,t,s)=>{const r=e.params.tweetId;try{const e=await o.getByTweetId(r);e?(await o.deleteTweet(r),t.json(e)):t.status(404).json({message:"Tweet not found"})}catch(e){s(e)}})),e.exports=r},706:(e,t,s)=>{const r=s(115);function o(e){return r("users").select("user_id","username").where("user_id",e).first()}e.exports={findAll:function(){return r("users").select("username","user_id").orderBy("user_id","asc")},getByFilter:function(e){return r("users").where(e)},getById:o,addUser:async function(e){const[t]=await r("users").insert(e);return await o(t)}}},348:(e,t,s)=>{const r=s(860).Router(),o=s(706);r.get("/",(async(e,t,s)=>{try{const e=await o.findAll();e?t.json(e):t.status(404).json({message:"Users not found"})}catch(e){s(e)}})),r.get("/:id",(async(e,t,s)=>{try{const s=await o.getById(e.params.id);s?t.json(s):t.status(404).json({message:"User not found"})}catch(e){s(e)}})),e.exports=r},631:e=>{e.exports=async(e,t,s)=>{const{username:r,password:o}=e.body;r&&o?s():t.status(401).json({message:"username ve şifre gereklidir"})}},942:(e,t,s)=>{const r=s(344),{JWT_SECRET:o}=s(632);e.exports=(e,t,s)=>{const n=e.headers.authorization;n?r.verify(n,o,((r,o)=>{r?t.status(401).json({message:"Token gecersizdir"}):(e.decodedToken=o,s())})):t.status(401).json({message:"Token gereklidir"})}},642:(e,t,s)=>{const r=s(706);e.exports=async(e,t,s)=>{const{username:o}=e.body,[n]=await r.getByFilter({username:o});n?(e.user=n,s()):t.status(401).json({message:"Geçersiz kriter"})}},763:(e,t,s)=>{const r=s(706),o=s(432),{HASH_ROUND:n}=s(632);e.exports=async(e,t,s)=>{const{username:a,password:i}=e.body,[c]=await r.getByFilter({username:a});if(c)t.status(422).json({message:"User zaten tanımlı"});else{const t=o.hashSync(i,n);e.hashedPassword=t,s()}}},530:(e,t,s)=>{const r=s(860),o=r();s(142).config();const n=s(806),a=s(582),i=s(234),c=s(543),d=s(106),u=s(561),w=s(845),l=s(348),m=s(942);o.use(n()),o.use(r.json()),o.use(a()),o.use("/api/auth",i),o.use("/api/users",l),o.use("/api/tweets",m,c),o.use("/api/likes",m,u),o.use("/api/comments",m,w),o.use("/api/followers",m,d),o.get("/",((e,t)=>{t.json({message:"Server up and running..."})})),o.use(((e,t,s,r)=>{s.status(e.status||500).json({message:e.message,stack:e.stack})})),e.exports=o},632:e=>{e.exports={HASH_ROUND:12,JWT_SECRET:process.env.JWT_SECRET||"shh"}},115:(e,t,s)=>{const r=s(514),o=s(159);e.exports=r(o.production)},159:e=>{const t={client:"sqlite3",useNullAsDefault:!0,migrations:{directory:"./data/migrations"},seeds:{directory:"./data/seeds"},pool:{afterCreate:(e,t)=>{e.run("PRAGMA foreign_keys = ON",t)}}};e.exports={development:{...t,connection:{filename:"./data/twitter.db3"}},testing:{...t,connection:{filename:"./data/testing.db3"}}}},432:e=>{"use strict";e.exports=require("bcryptjs")},582:e=>{"use strict";e.exports=require("cors")},142:e=>{"use strict";e.exports=require("dotenv")},860:e=>{"use strict";e.exports=require("express")},806:e=>{"use strict";e.exports=require("helmet")},344:e=>{"use strict";e.exports=require("jsonwebtoken")},514:e=>{"use strict";e.exports=require("knex")}},t={};function s(r){var o=t[r];if(void 0!==o)return o.exports;var n=t[r]={exports:{}};return e[r](n,n.exports,s),n.exports}(()=>{const e=s(530),t=process.env.PORT||9e3;e.listen(t,(()=>{console.log(`Server started at: ${t}`)}))})()})();